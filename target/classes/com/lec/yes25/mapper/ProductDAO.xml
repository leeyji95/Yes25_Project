<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lec.yes25.product.mapper.ProductDAO">

<select id="select" resultType="com.lec.yes25.product.dto.BookDTO">
	<![CDATA[
	SELECT *
	FROM 
	(SELECT rownum AS rnum, vb.* 
	FROM VIEW_BOOK vb)
	WHERE RNUM >= 1 + (#{param1} - 1)*#{param2} AND RNUM < 1 + #{param1}*#{param2}
	]]>
</select>

<select id="selectByUid" resultType="com.lec.yes25.product.dto.BookDTO">
	SELECT 
		* 
	FROM view_book 
	WHERE bookUid = #{param1}
</select>

<select id="selectCount" resultType="int">
	SELECT count(*) FROM TB_BOOK
</select>

<insert id="insert" flushCache="true"
	parameterType="com.lec.yes25.product.dto.BookDTO" useGeneratedKeys="true">
	INSERT INTO TB_BOOK 
	(BOOK_UID, BOOK_SUBJECT, BOOK_AUTHOR, BOOK_CONTENT, BOOK_PRICE, BOOK_PUBDATE, BOOK_REGDATE, BOOK_ISBN, CATEGORY_UID, PUBLISHER_UID) 
	VALUES
	(book_seq.nextval, #{subject}, #{author}, #{content}, #{price}, SYSDATE, SYSDATE, #{isbn}, #{categoryUid}, #{pubUid})
	<selectKey keyProperty="bookUid" resultType="Integer" order="AFTER">
		SELECT book_seq.currval FROM dual
	</selectKey>
</insert>

<delete id="deleteByUid" flushCache="true">
DELETE FROM TB_BOOK WHERE BOOK_UID = #{param1}
</delete>

<update id="update" flushCache="true"
	parameterType="com.lec.yes25.product.dto.BookDTO">
UPDATE TB_BOOK 
SET 
	BOOK_SUBJECT = #{subject}, BOOK_AUTHOR = #{author}, BOOK_CONTENT = #{content}, BOOK_PRICE = #{price},
	BOOK_ISBN = #{isbn}, CATEGORY_UID = #{categoryUid}, PUBLISHER_UID = #{pubUid} 
WHERE BOOK_UID = #{bookUid}
</update>

</mapper>